<!doctype html>
<html>
<head>
<title>Bruttobrutto!</title>

<style>
  .ralign {
    text-align: right;
  }

</style>
<script>

function findTaxRate(palkka_v)
{
  veroprosentit = [{1000: 0.0}, {2000: 0.0}, {3000: 0.0}, {4000: 0.0}, {5000: 0.0}, {6000: 0.0}, {7000: 0.0}, {8000: 0.0}, {9000: 0.0}, {10000: 0.0}, {11000: 0.0}, {12000: 0.0}, {13000: 0.0}, {14000: 0.0}, {15000: 0.0}, {16000: 1.5}, {17000: 1.6}, {18000: 2.2}, {19000: 3.6}, {20000: 4.8}, {21000: 6.0}, {22000: 6.9}, {23000: 7.7}, {24000: 8.6}, {25000: 9.4}, {26000: 10.1}, {27000: 10.7}, {28000: 11.5}, {29000: 12.3}, {30000: 13.1}, {31000: 13.8}, {32000: 14.5}, {33000: 15.0}, {34000: 15.4}, {35000: 15.8}, {36000: 16.2}, {37000: 16.7}, {38000: 17.3}, {39000: 17.9}, {40000: 18.5}, {41000: 19.0}, {42000: 19.5}, {43000: 20.0}, {44000: 20.5}, {45000: 21.0}, {46000: 21.4}, {47000: 21.8}, {48000: 22.2}, {49000: 22.6}, {50000: 22.9}, {51000: 23.3}, {52000: 23.6}, {53000: 23.9}, {54000: 24.3}, {55000: 24.6}, {56000: 24.8}, {57000: 25.1}, {58000: 25.5}, {59000: 25.8}, {60000: 26.1}, {61000: 26.4}, {62000: 26.7}, {63000: 26.9}, {64000: 27.2}, {65000: 27.5}, {66000: 27.7}, {67000: 28.0}, {68000: 28.2}, {69000: 28.5}, {70000: 28.7}, {71000: 28.9}, {72000: 29.1}, {73000: 29.3}, {74000: 29.5}, {75000: 29.7}, {76000: 29.9}, {77000: 30.0}, {78000: 30.2}, {79000: 30.4}, {80000: 30.5}, {81000: 30.7}, {82000: 30.9}, {83000: 31.0}, {84000: 31.2}, {85000: 31.3}, {86000: 31.4}, {87000: 31.6}, {88000: 31.7}, {89000: 31.8}, {90000: 32.0}, {91000: 32.1}, {92000: 32.2}, {93000: 32.3}, {94000: 32.5}, {95000: 32.6}, {96000: 32.7}, {97000: 32.8}, {98000: 33.0}, {99000: 33.2}, {100000: 33.4}, {101000: 33.5}, {102000: 33.7}, {103000: 33.9}, {104000: 34.0}, {105000: 34.2}, {106000: 34.3}, {107000: 34.5}, {108000: 34.6}, {109000: 34.8}, {110000: 34.9}, {111000: 35.1}, {112000: 35.2}, {113000: 35.3}, {114000: 35.5}, {115000: 35.6}, {116000: 35.7}, {117000: 35.9}, {118000: 36.0}, {119000: 36.1}, {120000: 36.2}, {121000: 36.3}, {122000: 36.5}, {123000: 36.6}, {124000: 36.7}, {125000: 36.8}, {126000: 36.9}, {127000: 37.0}, {128000: 37.1}, {129000: 37.2}, {130000: 37.3}, {131000: 37.4}, {132000: 37.5}, {133000: 37.6}, {134000: 37.7}, {135000: 37.8}, {136000: 37.9}, {137000: 38.0}, {138000: 38.1}, {139000: 38.2}, {140000: 38.3}, {141000: 38.4}, {142000: 38.4}, {143000: 38.5}, {144000: 38.6}, {145000: 38.7}, {146000: 38.8}, {147000: 38.8}, {148000: 38.9}, {149000: 39.0}, {150000: 39.1}, {151000: 39.2}, {152000: 39.2}, {153000: 39.3}, {154000: 39.4}, {155000: 39.5}, {156000: 39.5}, {157000: 39.6}, {158000: 39.7}, {159000: 39.7}, {160000: 39.8}, {161000: 39.8}, {162000: 39.9}, {163000: 40.0}, {164000: 40.0}, {165000: 40.1}, {166000: 40.1}, {167000: 40.2}, {168000: 40.2}, {169000: 40.3}, {170000: 40.3}, {171000: 40.4}, {172000: 40.4}, {173000: 40.5}, {174000: 40.5}, {175000: 40.6}, {176000: 40.6}, {177000: 40.7}, {178000: 40.7}, {179000: 40.8}, {180000: 40.8}, {181000: 40.9}, {182000: 40.9}, {183000: 41.0}, {184000: 41.0}, {185000: 41.1}, {186000: 41.1}, {187000: 41.2}, {188000: 41.2}, {189000: 41.2}, {190000: 41.3}, {191000: 41.3}, {192000: 41.4}, {193000: 41.4}, {194000: 41.5}, {195000: 41.5}, {196000: 41.5}, {197000: 41.6}, {198000: 41.6}, {199000: 41.7}, {200000: 41.7}, {205000: 41.9}, {210000: 42.1}, {215000: 42.2}, {220000: 42.4}, {225000: 42.5}, {230000: 42.7}, {235000: 42.8}, {240000: 43.0}, {245000: 43.1}, {250000: 43.2}, {255000: 43.3}, {260000: 43.4}, {265000: 43.6}, {270000: 43.7}, {275000: 43.8}, {280000: 43.9}, {285000: 44.0}, {290000: 44.1}, {295000: 44.1}, {300000: 44.2}, {305000: 44.3}, {310000: 44.4}, {315000: 44.5}, {320000: 44.6}, {325000: 44.6}, {330000: 44.7}, {335000: 44.8}, {340000: 44.8}, {345000: 44.9}, {350000: 45.0}, {355000: 45.0}, {360000: 45.1}, {365000: 45.1}, {370000: 45.2}, {375000: 45.2}, {380000: 45.3}, {385000: 45.4}, {390000: 45.4}, {395000: 45.5}, {400000: 45.5}, {405000: 45.6}, {410000: 45.6}, {415000: 45.6}, {420000: 45.7}, {425000: 45.7}, {430000: 45.8}, {435000: 45.8}, {440000: 45.9}, {445000: 45.9}, {450000: 45.9}, {455000: 46.0}, {460000: 46.0}, {465000: 46.0}, {470000: 46.1}, {475000: 46.1}, {480000: 46.1}, {485000: 46.2}, {490000: 46.2}, {495000: 46.2}, {500000: 46.3}, {505000: 46.3}, {510000: 46.3}, {515000: 46.4}, {520000: 46.4}, {525000: 46.4}, {530000: 46.4}, {535000: 46.5}, {540000: 46.5}, {545000: 46.5}, {550000: 46.5}, {555000: 46.6}, {560000: 46.6}, {565000: 46.6}, {570000: 46.6}, {575000: 46.7}, {580000: 46.7}, {585000: 46.7}, {590000: 46.7}, {595000: 46.8}, {600000: 46.8}, {650000: 47.0}, {700000: 47.1}, {750000: 47.3}, {800000: 47.4}, {850000: 47.5}, {900000: 47.6}, {950000: 47.7}, {1000000: 47.8}, ]
  var value = null

  for (const kv of veroprosentit) {

    let key = Object.keys(kv)
    limit = parseInt(key)
    value = kv[key]
    if (limit > palkka_v) {
      break
    }
  }

  return value
}

function addBreakdownTitle(title)
{
  var table = document.getElementById("breakdown-table");
  var row = table.insertRow()
  var title_cell = row.insertCell(0)
  title_cell.colSpan = "4";
  title_cell.innerHTML = "<h4>" + title + "</h4>"
}

function addBreakdownHr()
{
  var table = document.getElementById("breakdown-table");
  var row = table.insertRow()
  var hr_cell = row.insertCell(0)
  hr_cell.colSpan = "4";
  hr_cell.innerHTML = "<hr/>"
}

function addHeaderRow()
{
  var table = document.getElementById("breakdown-table");

  var row = table.insertRow()
  row.style.fontWeight = "bold"

  var name_cell = row.insertCell(0)
  var rate_cell = row.insertCell(1)
  var value_cell = row.insertCell(2)
  var yearly_cell = row.insertCell(3)

  value_cell.innerHTML = "kuukaudessa"
  value_cell.classList.add("ralign")

  yearly_cell.innerHTML = "vuodessa"
  yearly_cell.classList.add("ralign")
}

function addBreakdownRow(args)
{
  var table = document.getElementById("breakdown-table");

  var row = table.insertRow()

  if (args.bold) {
    row.style.fontWeight = "bold"
  }

  var name_cell = row.insertCell(0)
  var rate_cell = row.insertCell(1)
  var value_cell = row.insertCell(2)
  var yearly_cell = row.insertCell(3)

  if (args.name) {
    name_cell.innerHTML = args.name + ":"
  } + ":"

  if (args.rate) {
    rate_cell.innerHTML = toPercent(args.rate)
    rate_cell.classList.add("ralign")
  }

  if (args.eur) {
    value_cell.innerHTML = toEuro(args.eur)
    value_cell.classList.add("ralign")

    yearly_cell.innerHTML = toEuro(args.eur * 12)
    yearly_cell.classList.add("ralign")

  } else if (args.pct) {
    value_cell.innerHTML = toPercent(args.pct)
    value_cell.classList.add("ralign")
  }
}

function clearBreakdownTable()
{
  var table = document.getElementById("breakdown-table")
  table.innerHTML = ""
}

function toEuro(x)
{
  return parseFloat(x).toFixed(2).toString().replace(".", ",") + " €"
}

function toPercent(x)
{
  return (x * 100.0).toFixed(2).toString().replace(".", ",") + " %"
}

function calculate(bruttopalkka_kk)
{
  let palkka_pv = bruttopalkka_kk / (365/12)
  let lomaraha_v = palkka_pv * 0.5 * (12 * 2.5 /* num pv */)
  let lomaraha_per_kk = lomaraha_v / 12

  let palkka_kk = bruttopalkka_kk + lomaraha_per_kk

  let tyoelakemaksu_ratio           = 0.1870 // nuorehko
  let sairasvakuutusmaksu_ratio     = 0.0134
  let tapaturmavakuutusmaksu_ratio  = 0.0070 // tilastollinen
  let tyottomyysvakuutusmaksu_ratio = 0.0050 // pieni tyonantaja

  let tyoelakemaksu_kk            = palkka_kk * tyoelakemaksu_ratio
  let sairasvakuutusmaksu_kk      = palkka_kk * sairasvakuutusmaksu_ratio
  let tapaturmavakuutusmaksu_kk   = palkka_kk * tapaturmavakuutusmaksu_ratio
  let tyottomyysvakuutusmaksu_kk  = palkka_kk * tyottomyysvakuutusmaksu_ratio

  let tyoterveyskulut_kk = 453 / 12 // 2020 tilasto

  let tyonantajamaksut_kk = tyoelakemaksu_kk
    + sairasvakuutusmaksu_kk
    + tapaturmavakuutusmaksu_kk
    + tyottomyysvakuutusmaksu_kk
    + tyoterveyskulut_kk

  let palkkakulut_yht_kk = palkka_kk + tyonantajamaksut_kk

  clearBreakdownTable()

  addHeaderRow()

  addBreakdownHr()

  addBreakdownRow({ name: "Bruttopalkka",                   eur: bruttopalkka_kk })
  addBreakdownRow({ name: "Lomaraha",                       eur: lomaraha_per_kk })
  addBreakdownRow({ name: "Bruttopalkka lomarahan kanssa",  eur: palkka_kk, bold: true })

  addBreakdownHr()

  addBreakdownTitle("Työnantajan maksamat pakolliset veronomaiset kulut")

  addBreakdownRow({ name: "Työeläkemaksu (TyEL)",     rate: tyoelakemaksu_ratio,            eur: tyoelakemaksu_kk })
  addBreakdownRow({ name: "Sairasvakuutusmaksu",      rate: sairasvakuutusmaksu_ratio,      eur: sairasvakuutusmaksu_kk })
  addBreakdownRow({ name: "Tapaturmavakuutusmaksu",   rate: tapaturmavakuutusmaksu_ratio,   eur: tapaturmavakuutusmaksu_kk })
  addBreakdownRow({ name: "Työttömyysvakuutusmaksu",  rate: tyottomyysvakuutusmaksu_ratio,  eur: tyottomyysvakuutusmaksu_kk })

  addBreakdownRow({ name: "Työterveyskulut",             eur: tyoterveyskulut_kk })
  addBreakdownRow({ name: "Työnantajamaksut yhteensä",   eur: tyonantajamaksut_kk,  bold: true })
  addBreakdownRow({ name: "Palkkakustannukset yhteensä", eur: palkkakulut_yht_kk,   bold: true })
  addBreakdownHr()

  tt_vero_ratio                     = findTaxRate(palkka_kk * 12) * 0.01
  tt_elakevakuutusmaksu_ratio       = 0.0715
  tt_tyottomyysvakuutusmaksu_ratio  = 0.0150 

  tt_vero_kk                    = palkka_kk * tt_vero_ratio
  tt_elakevakuutusmaksu_kk      = palkka_kk * tt_elakevakuutusmaksu_ratio
  tt_tyottomyysvakuutusmaksu_kk = palkka_kk * tt_tyottomyysvakuutusmaksu_ratio

  tt_verot_ja_maksut = tt_vero_kk + tt_elakevakuutusmaksu_kk + tt_tyottomyysvakuutusmaksu_kk
  nettopalkka_kk = palkka_kk - tt_verot_ja_maksut

  addBreakdownTitle("Työntekijän palkasta vähennetyt verot ja kuluosuudet")

  addBreakdownRow({ name: "Verot",                    rate: tt_vero_ratio,                    eur: tt_vero_kk })
  addBreakdownRow({ name: "Työeläkemaksu",            rate: tt_elakevakuutusmaksu_ratio,      eur: tt_elakevakuutusmaksu_kk })
  addBreakdownRow({ name: "Työttömyysvakuutusmaksu",  rate: tt_tyottomyysvakuutusmaksu_ratio, eur: tt_tyottomyysvakuutusmaksu_kk })
  addBreakdownRow({ name: "Palkasta vähennettävät yhteensä",      eur: tt_verot_ja_maksut, bold: true })
  addBreakdownRow({ name: "Nettopalkka", eur: nettopalkka_kk, bold: true })

  addBreakdownHr()

  tt_todellinen_veronluonteinen_kk = palkkakulut_yht_kk - nettopalkka_kk
  tt_todellinen_veronluonteinen_ratio = tt_todellinen_veronluonteinen_kk / palkkakulut_yht_kk

  addBreakdownRow({ name: "Todelliset verot ja lakisääteiset veronluonteiset maksut",  eur: tt_todellinen_veronluonteinen_kk })
  addBreakdownRow({ name: "Todellinen toteutuva veroprosentti",                        pct: tt_todellinen_veronluonteinen_ratio })
}


</script>
</head>
<body>

  <table>

    <tr>
      <td>
        <label for="salary">Kuukausipalkka bruttona:</label>
      </td>
      <td>
        <input type="text" id="gross-salary" name="gross-salary" size="10" value="3217">
      </td>
    </tr>

    <tr>
      <td>
        <input type="radio" id="default-tax-rate" name="tax-rate-type" value="default" checked="true">
        <label for="default-tax-rate">Laske ennakonpidätysprosentti bruttopalkasta</label>
      </td>
    </tr>

    <tr>
      <td>
        <input type="radio" id="custom-tax-rate" name="tax-rate-type" value="custom">
        <label for="custom-tax-rate">Syötä ennakonpidätysprosentti:</label>
      </td>
      <td>
        <input type="text" id="tax-rate" name="tax-rate" size="10" value="">
      </td>
    </tr>

    <tr>
      <td>
        <input type="button" value="Laske" onclick="calculate(parseFloat(document.getElementById('gross-salary').value))">
      </td>
    </tr>
  </table>

  <table id="breakdown-table"></table>

</body>
</html>
